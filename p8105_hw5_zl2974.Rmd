---
title: "HW 5"
author: "Jeffrey Liang"
date: "11/10/2020"
output: github_document
---

```{r setup, include=FALSE}
library(tidyverse)
library(readxl)
library(patchwork)
knitr::opts_chunk$set(
  fig.height = 6,
  fig.width = 8,
  message = F,
  echo = F,
  warning = F,
  cache = T
)
theme_set(theme_minimal() + theme(legend.position = "bottom"))
options(
  ggplot2.continuous.colour = "viridis",
  ggplot2.continuous.fill = "viridis",
  digits = 3
)
scale_colour_discrete = scale_colour_viridis_d
scale_fill_discrete = scale_fill_viridis_d

```


# Problem 2

## Read the data
```{r read_data}
rct_dat =
  tibble(file_name =
           list.files(here::here("data"),
                      "con|exp",
                      full.names = T)) %>%
  mutate(data = map(file_name, read_csv)) %>%
  unnest(data) %>%
  mutate(group = str_extract_all(file_name, "(exp_\\d+|con_\\d+)")) %>%
  separate(group, into = c("arm", "subject_id")) %>%
  pivot_longer(
    week_1:week_8,
    names_to = "number_of_week",
    values_to = "observation",
    names_prefix = "week_"
  ) %>%
  mutate(across(number_of_week, as.numeric)) %>%
  select(-file_name)

rct_dat %>% head() %>% knitr::kable()
```


## Plot data
```{r}
plt_spaghetti =
  rct_dat %>%
  unite("id", c(arm, subject_id), sep = ":", remove = F) %>%
  ggplot(aes(x = number_of_week,
             y = observation)) +
  geom_path(aes(color = arm,
                group = as.factor(id)),
            alpha = 0.5) +
  geom_smooth(aes(color = arm), se = F)

show(plt_spaghetti)
```

\ As we can see from above, the observation from experiment group starts at the same level as the control group, increases as time passes, while the observation in control group stay at the same level.
